#Copyright Omnibond Systems, LLC. All rights reserved.

# This file is part of CCQHub.

# CCQHub is free software: you can redistribute it and/or modify
# it under the terms of the GNU Lesser General Public License as published by
# the Free Software Foundation, either version 2 of the License, or
# (at your option) any later version.

# CCQHub is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU Lesser General Public License for more details.

import argparse
import sys
import json
import traceback
import urllib2
import getpass
import os
import base64
import ccqHubMethods
import ccqHubVars
import threading

def main():
    ccqHubVars.init()
    if ccqHubVars.ccqHubDBLock is None:
        ccqHubVars.ccqHubDBLock = threading.RLock()
    
    parser = argparse.ArgumentParser(description="A ccqHub utility that allows an administrator to add a new Target for ccqHub to submit jobs to.")
    parser.add_argument('-V', '--version', action='version', version='ccqdel (version 0.1)')
    parser.add_argument('-i', '--identity', help="The path to the ccqHub generated API key. This key is generated by the ccqHub application when it is first run.", default=None)
    parser.add_argument('-tn', '--targetName', help="The name of the scheduler that is being configured.", default=None)
    parser.add_argument('-ta', '--targetAddress', help="The publicly routable DNS name/IP address where the target can be reached.", default=None)
    parser.add_argument('-st', '--schedType', help="The type of scheduler that is being added.", default=None)
    parser.add_argument('-p', '--protocol', help="The protocol that is used for submitting jobs at the target.", default=None)
    parser.add_argument('-a', '--auth', help="The auth mode that is specified for the target.", default=None)

    args = parser.parse_args()

    identity = args.identity
    targetName = args.targetName
    targetAddress = args.targetAddress
    schedType = args.schedType
    protocol = args.protocol
    auth = args.auth

    try:
        rootKeyFile = open(str(identity), "r")
        rootKey = rootKeyFile.readline()
        ccqHubMethods.checkKey(rootKey, ['root'])
    except Exception as e:
        print traceback.format_exc(e)

main()
